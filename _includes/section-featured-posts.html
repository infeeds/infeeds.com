{% assign featured_posts = site.posts | where: "featured", true | slice: 0, 4 %}

{% if featured_posts.size > 0 %}
<!-- begin featured-post -->
<section class="section featured-post animate">
  <div class="container">
    <div class="row">

      {% for post in featured_posts %}
      <div class="article col {% if forloop.first %}col-12 article--first{% else %}col-4 col-d-6 col-t-12{% endif %}">
        <div class="article__inner">

          <div class="article__head">

            {% if post.video_embed %}
            <div class="video-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                <polygon points="40,30 65,50 40,70"></polygon>
              </svg>
            </div>
            {% endif %}

            {% if post.image %}
            <a href="{{ post.url | prepend: site.baseurl }}" class="article__image" aria-hidden="true" tabindex="-1">
              <img class="lazy" data-src="{{ site.baseurl }}{{ post.image }}" alt="{{ post.title }}">
            </a>
            {% endif %}

          </div>

          <div class="article__content">

            {% if post.tags and post.tags.size > 0 %}
            <div class="article__tags">
              {% for tag in post.tags %}
              <a href="{{ site.baseurl }}/tags/?tag={{ tag | downcase | url_encode }}"
                 class="article__tag {% if post.tags_color %}tag-color-js{% endif %}"
                 {% if post.tags_color %}data-accent="{{ post.tags_color }}" style="color: {{ post.tags_color }};"{% endif %}>
                {{ tag }}
              </a>
              {% endfor %}
            </div>
            {% endif %}

            <h2 class="article__title">
              <a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a>
            </h2>

            <p class="article__excerpt">
              {% if post.description %}
                {{ post.description }}
              {% else %}
                {{ post.content | strip_html | truncate: 160 }}
              {% endif %}
            </p>

            <div class="article__meta">
              {% assign author = site.authors | where: "username", post.author | first %}

              <a href="{% if author %}{{ author.url }}{% else %}{{ site.baseurl }}/about/{% endif %}" class="article__author__image">
                <img class="lazy"
                     data-src="{% if author %}{{ author.image }}{% else %}{{ site.data.settings.author.author__avatar }}{% endif %}"
                     alt="{% if author %}{{ author.name }}{% else %}{{ site.data.settings.author.author__name }}{% endif %}">
              </a>

              <div class="article__meta__bottom">
                <a class="article__author__name" href="{% if author %}{{ author.url }}{% else %}{{ site.baseurl }}/about/{% endif %}">
                  {% if author %}{{ author.name }}{% else %}{{ site.data.settings.author.author__name }}{% endif %}
                </a>
                <time class="article__date" datetime="{{ post.date | date_to_xmlschema }}">
                  {{ post.date | date_to_string }}
                </time>
              </div>
            </div>

          </div>
        </div>
      </div>
      {% endfor %}

    </div>
  </div>
</section>
<!-- end featured-post -->
{% endif %}